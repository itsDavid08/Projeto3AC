A51 MACRO ASSEMBLER  PROJETO_ASSEMBLY                                                     05/23/2024 00:08:41 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\Projeto_Assembly.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE Projeto_Assembly.a51 SET(SMALL) DEBUG PRINT(.\Listings\Projeto_Assembly
                      .lst) OBJECT(.\Objects\Projeto_Assembly.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     ; Include the standard 8051 register definitions
                       2     
                       3     
----                   4     CSEG AT 0300H
0300 40792430          5             segmentos1:                     DB 0x40, 0x79, 0x24, 0x30, 0x19, 0x12, 0x02, 0x78, 
                             0x00 , 0x10, 0x3F ; 0. , 1. , 2. , 3. , 4. , 5. , 6. , 7. , 8. , 9. , -. 
0304 19120278                
0308 00103F                  
030B C0F9A4B0          6             segmentos2:                     DB      0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0
                             xF8, 0x80, 0x90 , 0xBF, 0x88, 0x83, 0xC6, 0XA1;0, 1, 2, 3, 4, 5, 6, 7, 8, 9
030F 999282F8                
0313 8090BF88                
0317 83C6A1                  
                       7     ; Define constants for timer reload values
  00D8                 8     TempoH EQU 0D8h
  00F0                 9     TempoL EQU 0F0h
                      10     
                      11     ; Define segment bit locations for display D1 and D2
  0090                12     D1 EQU P1
  00A0                13     D2 EQU P2
                      14             
                      15             
  00B4                16     bA BIT P3.4
  00B5                17     bB BIT P3.5
  00B6                18     bC BIT P3.6
  00B7                19     bD BIT P3.7
                      20     
                      21     
                      22     
----                  23     CSEG AT 0050h
0050                  24     INICIO:
                      25         ; Initialize the microcontroller
0050 7805             26         MOV R0, #5 ; segundos
0052 7900             27         MOV R1, #0 ; decimasSegundos
0054 7A00             28         MOV R2, #0 ; conta
0056 7B01             29         MOV R3, #1 ; start
0058 7C00             30         MOV R4, #0 ; resposta
005A 7D00             31             MOV R5, #0; GuardaSegundos
005C 7E00             32             MOV R6, #0; GuardaDecimasSegundos
                      33         
005E 75A88B           34         MOV IE, #8Bh   ; Enable interrupts EA, ET0, ET1, EX0
0061 75B800           35         MOV IP, #00h   ; Set default interrupt priorities
0064 758911           36         MOV TMOD, #11h ; Set Timer 0 and Timer 1 in Mode 1
                      37         
                      38         ; Set Timer 0 initial values for 5ms
0067 758CD8           39         MOV TH0, #TempoH
006A 758AF0           40         MOV TL0, #TempoL
                      41     
                      42         ; Set Timer 1 initial values for 50ms
006D 758DD8           43         MOV TH1, #TempoH
0070 758BF0           44         MOV TL1, #TempoL
                      45         
0073 C28C             46         CLR TR0
0075 C28E             47         CLR TR1
                      48         
0077 D288             49         SETB IT0
0079 D28A             50         SETB IT1
A51 MACRO ASSEMBLER  PROJETO_ASSEMBLY                                                     05/23/2024 00:08:41 PAGE     2

                      51     
                      52         ; Start the main loop
007B                  53     MAIN_LOOP:
007B 313B             54         CALL DISPLAY
007D 80FC             55         SJMP MAIN_LOOP
                      56     
                      57     ; External Interrupt 0 ISR
007F                  58     EX0_ISR:
007F EB               59         MOV A, R3 ; A <- Start
0080 6008             60         JZ EX0_ISR_s0
                      61         
0082 D28C             62         SETB TR0  ; Start Timer 0
0084 D28E             63         SETB TR1  ; Start Timer 1
0086 C2A8             64         CLR EX0   ; Disable external interrupt 0
                      65     
0088 801E             66         JMP Fim_EXO_ISR
                      67         
008A                  68     EX0_ISR_s0:
008A 7B01             69         MOV R3, #1 ;Start = 1
008C 7C00             70         MOV R4, #0 ; resposta = 0
008E 7805             71         MOV R0, #5 ; Segundos = 5
0090 7900             72         MOV R1, #0; DecimasSegundos = 0
                      73         
0092 85D88C           74         MOV TH0, TempoH
0095 85F08A           75         MOV TL0, TempoL
                      76         
0098 85D88D           77         MOV TH1, TempoH
009B 85F08B           78         MOV TL1, TempoL
                      79         
009E D28C             80         SETB TR0
00A0 C28E             81         CLR TR1
00A2 C2A8             82         CLR EX0
00A4 C2AA             83         CLR EX1
00A6 7A00             84         MOV R2, #0 ; Start = 0 
                      85         
00A8                  86     Fim_EXO_ISR:  
00A8 32               87         RETI
                      88     
                      89     ; Timer 0 ISR - Debounce handling
00A9                  90     TIMER0_ISR:
00A9 C28C             91         CLR TR0   ; Stop Timer 0
                      92         
00AB C289             93         CLR IE0   ; Clear External Interrupt 0 flag
00AD C28B             94         CLR IE1
                      95         
00AF D2A8             96         SETB EX0
00B1 D2AA             97         SETB EX1  ; Re-enable External Interrupt 0
                      98     
                      99         ; Reset Timer 0
00B3 758CD8          100         MOV TH0, #TempoH
00B6 758AF0          101         MOV TL0, #TempoL
                     102     
00B9 32              103         RETI
                     104     
                     105     ; External Interrupt 1 ISR - Response handling
00BA                 106     EX1_ISR:
00BA D28C            107         SETB TR0  ; Start Timer 0
00BC C2AA            108         CLR EX1   ; Disable external interrupt 1
                     109     
                     110         ; Check which response is selected
00BE 30B40B          111         JNB bA, SELECT_A
00C1 30B50C          112         JNB bB, SELECT_B
00C4 30B60D          113         JNB bC, SELECT_C
00C7 30B70E          114         JNB bD, SELECT_D
                     115     
00CA 800E            116         JMP HANDLE_RESPONSE
A51 MACRO ASSEMBLER  PROJETO_ASSEMBLY                                                     05/23/2024 00:08:41 PAGE     3

                     117     
00CC                 118     SELECT_A:
00CC 7C01            119         MOV R4, #1
00CE 800A            120         SJMP HANDLE_RESPONSE
                     121     
00D0                 122     SELECT_B:
00D0 7C02            123         MOV R4, #2
00D2 8006            124         SJMP HANDLE_RESPONSE
                     125     
00D4                 126     SELECT_C:
00D4 7C03            127         MOV R4, #3
00D6 8002            128         SJMP HANDLE_RESPONSE
                     129     
00D8                 130     SELECT_D:
00D8 7C04            131         MOV R4, #4
                     132     
00DA                 133     HANDLE_RESPONSE:
00DA 7B00            134         MOV R3, #0   ; Start = 0 
00DC E8              135             MOV A, R0   
00DD FD              136             MOV R5, A; GuardaSegundos = Segundos
00DE E9              137             MOV A, R1
00DF FE              138             MOV R6, A ;GuardaDecimasSegundos = DecimasSegundos
                     139     
00E0 32              140         RETI
                     141     
                     142     
                     143     ; Timer 1 ISR - Counting time and display control
00E1                 144     TIMER1_ISR:
                     145         ; Check if still counting down
                     146             
                     147             
                     148             
00E1 EB              149         MOV A, R3
00E2 B4011A          150         CJNE A, #1, NOT_COUNTING ; IF(start==0)
                     151             
00E5 EA              152             MOV A, R2
00E6 B40A48          153             CJNE A, #10, CONTINUE_COUNTING ; If(conta ==10){
00E9 7A00            154             MOV R2, #0; conta = 0
                     155             
                     156             
00EB E9              157             MOV A , R1
00EC 700E            158         JNZ DecrementaDecimas ;IF(DecimasSegundos==0)
                     159             ;else{
00EE 7909            160         MOV R1, #9
00F0 D842            161         DJNZ R0, Return
                     162             ;}
                     163             
                     164             
                     165             ;if(Segundos == 0 & DecimasSegundos == 0){
00F2 E8              166             MOV A , R0
00F3 FD              167         MOV R5, A
00F4 E9              168             MOV A, R1
00F5 FE              169             MOV R6, A
00F6 7B00            170             MOV R3, #0
00F8 7A00            171             MOV R2, #0
                     172             
                     173     
00FA 8038            174         JMP Return
                     175             ;}
                     176             ;}
00FC                 177     DecrementaDecimas:
00FC 19              178             DEC R1; DecimasSegundos --
00FD 8035            179             JMP Return
                     180     
                     181             
00FF                 182     NOT_COUNTING:
A51 MACRO ASSEMBLER  PROJETO_ASSEMBLY                                                     05/23/2024 00:08:41 PAGE     4

00FF EA              183         MOV A, R2
0100 B4642E          184             CJNE A, #100, CONTINUE_COUNTING ; If(conta ==100){
0103 7A00            185             MOV R2, #0; conta = 0
0105 E8              186             MOV A, R0
0106 B40A06          187             CJNE A, #10, NotSecond; if(segundos = 10)
0109 ED              188             MOV A, R5; Segundos = GuardaSegundos
010A F8              189             MOV R0, A 
010B EE              190             MOV A, R6
010C F9              191             MOV R1,A; DecimasSegundos = GuardaDecimasSegundos
010D 8025            192             JMP Return
                     193     
010F                 194     NotSecond:
                     195     
010F 780A            196             MOV R0, #10
0111 BC0104          197             CJNE R4, #1, RespostaB
0114 790B            198             MOV R1, #11
0116 801C            199             JMP Return
0118                 200     RespostaB:
0118 BC0204          201             CJNE R4, #2,RespostaC
011B 790C            202             MOV R1, #12
011D 8015            203             JMP Return
011F                 204     RespostaC:
011F BC0304          205             CJNE R4, #3,RespostaD
0122 790D            206             MOV R1, #13
0124 800E            207             JMP Return
0126                 208     RespostaD:
0126 BC0404          209             CJNE R4, #4,RespostaDefault
0129 790E            210             MOV R1, #14
012B 8007            211             JMP Return
                     212             
012D                 213     RespostaDefault:        
012D 790A            214             MOV R1, #10
012F 8003            215             JMP Return      
                     216     
                     217     
0131                 218     CONTINUE_COUNTING:
0131 0A              219         INC R2 ; CONTA++
0132 8000            220             JMP Return
0134                 221     Return:
0134 758DD8          222         MOV TH1, #TempoH
0137 758BF0          223         MOV TL1, #TempoL            
013A 32              224             RETI    
                     225     
                     226     ; Display subroutine - Control the 7-segment displays
013B                 227     DISPLAY:
                     228         ; Display digit D1 based on seconds
013B E8              229         MOV A, R0
013C 3142            230         ACALL DISPLAY_DIGIT_D1
                     231     
                     232         ; Display digit D2 based on tenths of seconds
013E E9              233         MOV A, R1
013F 3149            234         ACALL DISPLAY_DIGIT_D2
                     235         
                     236         
0141 22              237         RET
                     238     
0142                 239     DISPLAY_DIGIT_D1:
                     240         ; Lookup segment values for display D1
0142 900300          241         MOV DPTR, #segmentos1
0145 93              242         MOVC A, @A+DPTR
                     243     
                     244         ; Update segments for D1
0146 F590            245         MOV D1, A
0148 22              246         RET
                     247     
0149                 248     DISPLAY_DIGIT_D2:
A51 MACRO ASSEMBLER  PROJETO_ASSEMBLY                                                     05/23/2024 00:08:41 PAGE     5

                     249         ; Lookup segment values for display D2
0149 90030B          250         MOV DPTR, #segmentos2
014C 93              251         MOVC A, @A+DPTR
                     252         ; Update segments for D2
014D F5A0            253         MOV D2, A
014F 22              254         RET
                     255         
                     256     
                     257     
                     258     ; Segmento de interrupção
----                 259     CSEG AT 0000h
0000 020050          260         LJMP INICIO
----                 261     CSEG AT 0003h 
0003 02007F          262         LJMP EX0_ISR
----                 263     CSEG AT 000Bh
000B 0200A9          264         LJMP TIMER0_ISR
----                 265     CSEG AT 0013h
0013 0200BA          266         LJMP EX1_ISR
----                 267     CSEG AT 001Bh
001B 0200E1          268         LJMP TIMER1_ISR
                     269     
                     270     END
A51 MACRO ASSEMBLER  PROJETO_ASSEMBLY                                                     05/23/2024 00:08:41 PAGE     6

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

BA . . . . . . . .  B ADDR   00B0H.4 A   
BB . . . . . . . .  B ADDR   00B0H.5 A   
BC . . . . . . . .  B ADDR   00B0H.6 A   
BD . . . . . . . .  B ADDR   00B0H.7 A   
CONTINUE_COUNTING.  C ADDR   0131H   A   
D1 . . . . . . . .  D ADDR   0090H   A   
D2 . . . . . . . .  D ADDR   00A0H   A   
DECREMENTADECIMAS.  C ADDR   00FCH   A   
DISPLAY. . . . . .  C ADDR   013BH   A   
DISPLAY_DIGIT_D1 .  C ADDR   0142H   A   
DISPLAY_DIGIT_D2 .  C ADDR   0149H   A   
EX0. . . . . . . .  B ADDR   00A8H.0 A   
EX0_ISR. . . . . .  C ADDR   007FH   A   
EX0_ISR_S0 . . . .  C ADDR   008AH   A   
EX1. . . . . . . .  B ADDR   00A8H.2 A   
EX1_ISR. . . . . .  C ADDR   00BAH   A   
FIM_EXO_ISR. . . .  C ADDR   00A8H   A   
HANDLE_RESPONSE. .  C ADDR   00DAH   A   
IE . . . . . . . .  D ADDR   00A8H   A   
IE0. . . . . . . .  B ADDR   0088H.1 A   
IE1. . . . . . . .  B ADDR   0088H.3 A   
INICIO . . . . . .  C ADDR   0050H   A   
IP . . . . . . . .  D ADDR   00B8H   A   
IT0. . . . . . . .  B ADDR   0088H.0 A   
IT1. . . . . . . .  B ADDR   0088H.2 A   
MAIN_LOOP. . . . .  C ADDR   007BH   A   
NOTSECOND. . . . .  C ADDR   010FH   A   
NOT_COUNTING . . .  C ADDR   00FFH   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
RESPOSTAB. . . . .  C ADDR   0118H   A   
RESPOSTAC. . . . .  C ADDR   011FH   A   
RESPOSTAD. . . . .  C ADDR   0126H   A   
RESPOSTADEFAULT. .  C ADDR   012DH   A   
RETURN . . . . . .  C ADDR   0134H   A   
SEGMENTOS1 . . . .  C ADDR   0300H   A   
SEGMENTOS2 . . . .  C ADDR   030BH   A   
SELECT_A . . . . .  C ADDR   00CCH   A   
SELECT_B . . . . .  C ADDR   00D0H   A   
SELECT_C . . . . .  C ADDR   00D4H   A   
SELECT_D . . . . .  C ADDR   00D8H   A   
TEMPOH . . . . . .  N NUMB   00D8H   A   
TEMPOL . . . . . .  N NUMB   00F0H   A   
TH0. . . . . . . .  D ADDR   008CH   A   
TH1. . . . . . . .  D ADDR   008DH   A   
TIMER0_ISR . . . .  C ADDR   00A9H   A   
TIMER1_ISR . . . .  C ADDR   00E1H   A   
TL0. . . . . . . .  D ADDR   008AH   A   
TL1. . . . . . . .  D ADDR   008BH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   
TR1. . . . . . . .  B ADDR   0088H.6 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
